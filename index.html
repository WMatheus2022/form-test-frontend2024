<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulario-test-frontend</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="fundo-cor">
      <div class="fundo-cor2">
        <h2>Cadastro Fornecedor/Produto</h2>
      </div>
      <h6 class="fundo-cor3">Dados do Fornecedor</h6>
      <br />
      <form class="row g-3 needs-validation" id="form" novalidate>
        <div class="col-md-4">
          <label for="validationCustom01" class="form-label"
            >Razão social</label
          >
          <input
            type="text"
            class="form-control"
            id="validationCustom01"
            required
          />
          <div class="valid-feedback">Looks good!</div>
        </div>
        <div class="col-md-4">
          <label for="validationCustom02" class="form-label">CNPJ</label>
          <input
            type="number"
            class="form-control"
            id="validationCustom02"
            required
          />
          <div class="valid-feedback">Looks good!</div>
        </div>
        <div class="col-md-2">
          <label for="validationCustom03" class="form-label">CEP</label>
          <input
            type="number"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="valid-feedback">Looks good!</div>
        </div>
        <div class="col-md-4">
          <label for="validationCustomUsername" class="form-label"
            >Nome fantasia</label
          >
          <div class="input-group has-validation">
            <input
              type="text"
              class="form-control"
              id="validationCustomUsername"
              aria-describedby="inputGroupPrepend"
              required
            />
            <div class="invalid-feedback">Por favor, preencha o campo.</div>
          </div>
        </div>
        <div class="col-md-3">
          <label for="validationCustom03" class="form-label"
            >Inscrição Estadual</label
          >
          <input
            type="text"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-3">
          <label for="validationCustom03" class="form-label"
            >Inscrição Municipal</label
          >
          <input
            type="text"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-4">
          <label for="validationCustom03" class="form-label">Endereço</label>
          <input
            type="text"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-2">
          <label for="validationCustom03" class="form-label">Número</label>
          <input
            type="number"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-4">
          <label for="validationCustom03" class="form-label">Complemento</label>
          <input
            type="text"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-4">
          <label for="validationCustom03" class="form-label">Bairro</label>
          <input
            type="text"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-3">
          <label for="validationCustom03" class="form-label">Municipal</label>
          <input
            type="text"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-2">
          <label for="validationCustom04" class="form-label">Estado</label>
          <select class="form-select" id="validationCustom04" required>
            <option selected disabled value="">Escolha...</option>
            <option>...</option>
          </select>
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-4">
          <label for="validationCustom03" class="form-label"
            >Nome da Pessoa de Contato</label
          >
          <input
            type="text"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-3">
          <label for="validationCustom03" class="form-label">Telefone</label>
          <input
            type="number"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-md-3">
          <label for="validationCustom03" class="form-label">E-mail</label>
          <input
            type="email"
            class="form-control"
            id="validationCustom03"
            required
          />
          <div class="invalid-feedback">Por favor, preencha o campo.</div>
        </div>
        <div class="col-12">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              value=""
              id="invalidCheck"
              required
            />
            <label class="form-check-label" for="invalidCheck">
              Aceito todos os termos.
            </label>
            <div class="invalid-feedback">Você precisa aceitar os termos.</div>
          </div>
        </div>
        <div class="col-12">
          <button class="btn btn-primary" id="botao-add" type="button">
            Adicionar Produto
          </button>
        </div>
      </form>
      <br />

      <div class="box" id="box-produto">
        <!-- Tabela dos Produtos -->
        <table class="table" id="tabela-produtos">
          <thead>
            <tr>
              <th>Descrição</th>
              <th>Unidade de Medida</th>
              <th>Quantidade em Estoque</th>
              <th>Valor Unitário</th>
              <th>Valor Total</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" class="descricao" /></td>
              <td><input type="text" class="unidade-medida" /></td>
              <td>
                <input
                  type="number"
                  class="quantidade"
                  onchange="atualizarValorTotal(this)"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="valor-unitario"
                  onchange="atualizarValorTotal(this)"
                />
              </td>
              <td><input type="text" class="valor-total" readonly /></td>
              <td><button onclick="removerLinha(this)">Excluir</button></td>
            </tr>
          </tbody>
        </table>
        <button onclick="adicionarLinha()">Adicionar Produto</button>
      </div>

      <br />

      <div class="box" id="box-anexo">
        <!-- Tabela dos Anexos -->
        <table class="table" id="tabela-anexos">
          <thead>
            <tr>
              <th>Nome do Documento</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- Anexos add aqui -->
          </tbody>
        </table>
        <input type="file" id="upload" />
        <button onclick="adicionarAnexo()">Adicionar Documento</button>
      </div>

      <br />

      <div class="col-12">
        <button class="btn btn-primary" onclick="salvarFornecedor()">
          Salvar Fornecedor
        </button>
      </div>
    </div>

    <script>
      // Funções da Tabela de Produtos
      function atualizarValorTotal(element) {
        const row = element.parentElement.parentElement;
        const quantidade = row.querySelector(".quantidade").value;
        const valorUnitario = row.querySelector(".valor-unitario").value;
        const valorTotalField = row.querySelector(".valor-total");
        valorTotalField.value = (quantidade * valorUnitario).toFixed(2);
      }

      function adicionarLinha() {
        const tabela = document
          .getElementById("tabela-produtos")
          .getElementsByTagName("tbody")[0];
        const novaLinha = tabela.insertRow();
        novaLinha.innerHTML = `
              <td><input type="text" class="descricao" /></td>
              <td><input type="text" class="unidade-medida" /></td>
              <td><input type="number" class="quantidade" onchange="atualizarValorTotal(this)" /></td>
              <td><input type="number" class="valor-unitario" onchange="atualizarValorTotal(this)" /></td>
              <td><input type="text" class="valor-total" readonly /></td>
              <td><button onclick="removerLinha(this)">Excluir</button></td>
          `;
      }

      function removerLinha(button) {
        const row = button.parentElement.parentElement;
        row.parentElement.removeChild(row);
      }

      // Funções da Tabela de Anexos
      let anexos = [];

      function adicionarAnexo() {
        const fileInput = document.getElementById("upload");
        const file = fileInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const fileData = e.target.result;
            anexos.push({ name: file.name, data: fileData });
            atualizarTabelaAnexos();
          };
          reader.readAsDataURL(file);
        }
      }

      function atualizarTabelaAnexos() {
        const tabela = document
          .getElementById("tabela-anexos")
          .getElementsByTagName("tbody")[0];
        tabela.innerHTML = "";
        anexos.forEach((anexo, index) => {
          const novaLinha = tabela.insertRow();
          novaLinha.innerHTML = `
                  <td>${anexo.name}</td>
                  <td>
                      <button onclick="visualizarAnexo(${index})">Visualizar</button>
                      <button onclick="removerAnexo(${index})">Excluir</button>
                  </td>
              `;
        });
      }

      function visualizarAnexo(index) {
        const anexo = anexos[index];
        const link = document.createElement("a");
        link.href = anexo.data;
        link.download = anexo.name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function removerAnexo(index) {
        anexos.splice(index, 1);
        atualizarTabelaAnexos();
      }

      // Função de Salvar Fornecedor
      function salvarFornecedor() {
        const produtos = [];
        const rows = document.querySelectorAll("#tabela-produtos tbody tr");
        rows.forEach((row) => {
          const descricao = row.querySelector(".descricao").value;
          const unidadeMedida = row.querySelector(".unidade-medida").value;
          const quantidade = row.querySelector(".quantidade").value;
          const valorUnitario = row.querySelector(".valor-unitario").value;
          const valorTotal = row.querySelector(".valor-total").value;
          produtos.push({
            descricao,
            unidadeMedida,
            quantidade,
            valorUnitario,
            valorTotal,
          });
        });

        const dados = {
          produtos,
          anexos: anexos.map((anexo) => ({
            nome: anexo.name,
            dados: anexo.data,
          })),
        };

        const jsonDados = JSON.stringify(dados, null, 2);
        console.log(jsonDados);

        //exibição do JSON no console e possibilidade de download
        const blob = new Blob([jsonDados], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "dados_fornecedor.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    </script>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"
      integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
